  :root { --bg:#000; --text:#eee; --accent:#00f0ff; --pink:#ff006e; --green:#00ff9d; }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; line-height:1.8; overflow-x:hidden; }
  #bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
  canvas#bg {
    position: fixed !important;
    top: 0; left: 0;
    width: 100vw !important;
    height: 100vh !important;
    z-index: -1;
    background: #000;
  }
  .hero {
    height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
    background:radial-gradient(circle at center, rgba(0,240,255,0.2), transparent);
  }
  h1 { font-size:7rem; font-weight:200; background:linear-gradient(90deg,var(--pink),#9d00ff,var(--accent));
       -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
  .subtitle { font-size:2.2rem; color:#888; margin-top:1rem; }

  .section { min-height:100vh; padding:8rem 2rem; display:flex; align-items:center; justify-content:center; }
  .card {
    background:rgba(255,255,255,0.04); backdrop-filter:blur(20px); border:2px solid rgba(0,240,255,0.2);
    border-radius:32px; padding:4rem; max-width:1200px; width:100%; box-shadow:0 30px 100px rgba(0,0,0,0.7);
    cursor:pointer; transition:all 0.6s ease; opacity:0; transform:translateY(80px);
  }
  .card:hover { transform:translateY(-15px); box-shadow:0 40px 120px rgba(0,240,255,0.4); }

  /* ИСПРАВЛЕНИЕ: активная карточка — теперь текст идеально с пробелами */
.card.active {
  border-color: var(--green);
  box-shadow: 0 0 80px rgba(0, 255, 157, 0.6);
  background: linear-gradient(135deg, rgba(0,255,157,0.08), rgba(0,240,255,0.05));

  /* САМОЕ ГЛАВНОЕ — УБИРАЕМ ВСЁ, ЧТО ЛОМАЕТ ПРОБЕЛЫ */
  backdrop-filter: none !important;        /* полностью выключаем блюр */
  -webkit-backdrop-filter: none !important;

  /* Принудительно включаем аппаратное ускорение — помогает Safari */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);

  /* Отключаем все возможные лигатуры и кернинги, которые могут "съедать" пробелы */
  font-feature-settings: "liga" 0, "kern" 0;
  -webkit-font-feature-settings: "liga" 0, "kern" 0;

  /* Немного увеличиваем межбуквенное расстояние — пробелы точно не слипнутся */
  letter-spacing: 0.8px !important;
}

  h2 { 
    font-size:3.8rem; margin-bottom:1.5rem; color:var(--accent); 
    text-shadow:0 0 30px var(--accent);
    letter-spacing: 0.5px;
  }
  
  /* Фикс для активной карточки — текст остаётся читаемым */
  .card.active h2,
  .card.active .formula,
  .card.active .explanation {
    color: #ffffff !important;
    text-shadow: 0 0 20px rgba(0,255,157,0.8) !important;
    letter-spacing: 0.8px !important;
  }

  .formula {
    font-size:3.2rem; margin:3rem 0; padding:2rem; background:rgba(0,255,157,0.1); border-radius:20px;
    color:var(--green); text-align:center; transition:all 0.5s; border:3px dashed transparent;
    letter-spacing: 1px;
    
  }
/* Текст, который НЕ должен обрабатываться MathJax */
.formula.text-only {
  font-size: 3.2rem !important;
  color: var(--green);
  background: rgba(0,255,157,0.1);
  padding: 2rem;
  border-radius: 20px;
  text-align: center;
  border: 3px dashed transparent;
  transition: all 0.5s;
  /* MathJax НЕ будет трогать этот элемент */
}

/* Активное состояние для обычного текста */
.card.active .formula.text-only {
  color: #ffffff !important;
  background: rgba(0,255,157,0.25) !important;
  border-color: var(--green) !important;
  transform: scale(1.08);
  text-shadow: 0 0 15px #00ff9d;
}
  .card.active .formula { 
    border-color:var(--green); 
    transform:scale(1.08); 
    background:rgba(0,255,157,0.25);
    color: #ffffff;
    text-shadow: 0 0 15px #00ff9d;
  }

  .explanation { 
    font-size:1.5rem; color:#ddd; margin:3rem 0; text-align:justify; line-height:2; 
    letter-spacing: 0.6px;
  }

  .chart-container { 
    height:520px; margin:3rem 0; background:rgba(0,0,0,0.5); border-radius:20px; 
    padding:1.5rem; overflow:hidden; position:relative;
  }
  .chart-container canvas { 
    width:100% !important; height:100% !important; display:block; 
    max-width:1000px; max-height:520px;
  }